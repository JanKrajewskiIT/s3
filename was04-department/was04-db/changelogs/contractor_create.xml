<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

	<changeSet id="init_changeset_postal_codes" author="bartosz.milczarek">
		<sql>
			CREATE TABLE POSTAL_CODES (
				POSTAL_CODE_ID BIGINT NOT NULL,
				CODE CHARACTER(6) NOT NULL,
				CITY CHARACTER VARYING(30) NOT NULL
			);
		</sql>
		<sql>
			ALTER TABLE ONLY POSTAL_CODES ADD CONSTRAINT POSTAL_CODES_PK PRIMARY KEY (POSTAL_CODE_ID);
			ALTER TABLE POSTAL_CODES ADD CONSTRAINT POSTAL_CODES_UK UNIQUE (CODE);
		</sql>
		<sqlFile path="../files/001_inserts_postal_codes.sql" relativeToChangelogFile="true" />
	</changeSet>
	<changeSet id="init_changeset_contractors_groups" author="bartosz.milczarek">		
		<sql>
			CREATE SEQUENCE CONTRACTORS_GROUPS_SEQ
			START WITH 1
			INCREMENT BY 1
			NO MINVALUE
			NO MAXVALUE
			CACHE 1;
		</sql>
		<sql>
			CREATE TABLE CONTRACTORS_GROUPS (
				CONTRACTOR_GROUP_ID BIGINT NOT NULL DEFAULT NEXTVAL('CONTRACTORS_GROUPS_SEQ'::REGCLASS),
				NAME CHARACTER VARYING(60) NOT NULL,
				IS_ACTIVE BOOLEAN DEFAULT TRUE NOT NULL,		
				VERSION BIGINT DEFAULT (1)::BIGINT NOT NULL
			);
		</sql>
		<sql>
			ALTER TABLE ONLY CONTRACTORS_GROUPS ADD CONSTRAINT CONTRACTORS_GROUPS_PK PRIMARY KEY (CONTRACTOR_GROUP_ID);
			ALTER SEQUENCE CONTRACTORS_GROUPS_SEQ OWNED BY CONTRACTORS_GROUPS.CONTRACTOR_GROUP_ID;
			SELECT PG_CATALOG.SETVAL('CONTRACTORS_GROUPS_SEQ', 1, TRUE);
		</sql>
	</changeSet>
	<!-- <changeSet id="init_changeset_member_sources" author="bartosz.milczarek">
		<sql>
			CREATE SEQUENCE MEMBER_SOURCES_SEQ
			START WITH 1
			INCREMENT BY 1
			NO MINVALUE
			NO MAXVALUE
			CACHE 1;
		</sql>
		<sql>
			CREATE TABLE MEMBER_SOURCES (
				MEMBER_SOURCE_ID BIGINT NOT NULL DEFAULT NEXTVAL('MEMBER_SOURCES_SEQ'::REGCLASS),
				NAME CHARACTER VARYING(60) NOT NULL,
				IS_ACTIVE BOOLEAN DEFAULT TRUE NOT NULL,		
				VERSION BIGINT DEFAULT (1)::BIGINT NOT NULL
			);
		</sql>
		<sql>
			ALTER TABLE ONLY MEMBER_SOURCES ADD CONSTRAINT MEMBER_SOURCES_PK PRIMARY KEY (MEMBER_SOURCE_ID);
			ALTER SEQUENCE MEMBER_SOURCES OWNED BY MEMBER_SOURCES.MEMBER_SOURCE_ID;
			SELECT PG_CATALOG.SETVAL('MEMBER_SOURCES_SEQ', 1, FALSE);
		</sql>
	</changeSet> -->
	<changeSet id="init_changeset_contractors_contacts" author="bartosz.milczarek">
		<sql>
			CREATE SEQUENCE CONTRACTORS_CONTACTS_SEQ
			START WITH 1
			INCREMENT BY 1
			NO MINVALUE
			NO MAXVALUE
			CACHE 1;
		</sql>
		<sql>
			CREATE TABLE CONTRACTORS_CONTACTS (
				CONTRACTOR_CONTACT_ID BIGINT NOT NULL DEFAULT nextval('CONTRACTORS_CONTACTS_SEQ'::regclass),
				CONTRACTOR_ID BIGINT NOT NULL,
				NAME character varying(60) NOT NULL,
				NUMBER character varying(20) NOT NULL,
				IS_DEFAULT boolean default false
			);
		</sql>
		<sql>
			ALTER TABLE ONLY CONTRACTORS_CONTACTS ADD CONSTRAINT CONTRACTORS_CONTACTS_PK PRIMARY KEY (CONTRACTOR_CONTACT_ID);
			ALTER TABLE CONTRACTORS_CONTACTS ADD CONSTRAINT CONTRACTORS_CONTACTS_FK1 FOREIGN KEY (CONTRACTOR_ID) REFERENCES CONTRACTORS (CONTRACTOR_ID) MATCH FULL;
			SELECT pg_catalog.setval('CONTRACTORS_CONTACTS_SEQ', 1, TRUE);
		</sql>
	</changeSet>
	<changeSet id="init_changeset_contractors" author="bartosz.milczarek">		
		<sql>
			CREATE SEQUENCE CONTRACTORS_SEQ
			START WITH 1
			INCREMENT BY 1
			NO MINVALUE
			NO MAXVALUE
			CACHE 1;
		</sql>
		<sql>
			CREATE TABLE CONTRACTORS (
				CONTRACTOR_ID BIGINT NOT NULL DEFAULT NEXTVAL('CONTRACTORS_SEQ'::REGCLASS),
				NAME TEXT NOT NULL,
				SYMBOL CHARACTER VARYING(70) NOT NULL,
				TYPE VARCHAR(10) NOT NULL,
				CONTRACTOR_GROUP_ID BIGINT DEFAULT (0)::BIGINT NOT NULL,
				POSTAL_CODE_ID BIGINT DEFAULT (0)::BIGINT NOT NULL,
				<!-- MEMBER_SOURCE_ID BIGINT DEFAULT (0)::BIGINT NOT NULL, -->
            	CITY CHARACTER VARYING(40) NOT NULL,
				ADRESS CHARACTER VARYING(60) NOT NULL,
				NIP CHARACTER VARYING(13),
				DISCOUNT NUMERIC(4,2) DEFAULT 0.00 NOT NULL,
				DESCRIPTION TEXT NOT NULL,
				ACCOUNT_NUMBER CHARACTER VARYING(34),
				WEBSITE CHARACTER VARYING(60) NOT NULL,
				EMAIL CHARACTER VARYING(60) NOT NULL,
				REPRESENTATIVE CHARACTER VARYING(70),
				IS_COMPANY BOOLEAN DEFAULT FALSE,
				IS_SUPPLIER BOOLEAN DEFAULT FALSE,
				IS_ACTIVE BOOLEAN DEFAULT TRUE,		
				VERSION BIGINT DEFAULT (1)::BIGINT NOT NULL
			);
		</sql>
		<sql>
			ALTER TABLE ONLY CONTRACTORS ADD CONSTRAINT CONTRACTORS_PK PRIMARY KEY (CONTRACTOR_ID);
			ALTER TABLE CONTRACTORS ADD CONSTRAINT CONTRACTORS_FK1 FOREIGN KEY (CONTRACTOR_GROUP_ID) REFERENCES CONTRACTORS_GROUPS (CONTRACTOR_GROUP_ID) MATCH FULL;
			ALTER TABLE CONTRACTORS ADD CONSTRAINT CONTRACTORS_FK2 FOREIGN KEY (POSTAL_CODE_ID) REFERENCES POSTAL_CODES (POSTAL_CODE_ID) MATCH FULL;
			<!-- ALTER TABLE CONTRACTORS ADD CONSTRAINT CONTRACTORS_FK3 FOREIGN KEY (MEMBER_SOURCE_ID) REFERENCES MEMBER_SOURCES (MEMBER_SOURCE_ID) MATCH FULL;-->
			ALTER SEQUENCE CONTRACTORS_SEQ OWNED BY CONTRACTORS.CONTRACTOR_ID; 
			SELECT PG_CATALOG.SETVAL('CONTRACTORS_SEQ', 1, TRUE);
		</sql>
	</changeSet>
</databaseChangeLog>