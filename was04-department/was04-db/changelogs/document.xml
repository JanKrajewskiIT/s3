<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">
	
	<changeSet id="init_changeset_payment_methods" author="bartosz.milczarek">
		<sql>
			CREATE SEQUENCE PAYMENT_METHODS_SEQ
			START WITH 1
			INCREMENT BY 1
			NO MINVALUE
			NO MAXVALUE
			CACHE 1;
		</sql>
		<sql>
			CREATE TABLE PAYMENT_METHODS (
				PAYMENT_METHOD_ID BIGINT NOT NULL DEFAULT NEXTVAL('METHODS_OF_PAYMENT_SEQ'::REGCLASS),
				NAME CHARACTER VARYING(35) DEFAULT NULL::CHARACTER VARYING,
				MATURITY SMALLINT DEFAULT (0)::SMALLINT,
				IS_ACTIVE BOOLEAN DEFAULT TRUE NOT NULL,		
				VERSION BIGINT DEFAULT (1)::BIGINT NOT NULL
			);
		</sql>
		<sql>
			ALTER TABLE ONLY METHODS_OF_PAYMENT ADD CONSTRAINT METHODS_OF_PAYMENT_PK PRIMARY KEY (MOP_ID);
			ALTER SEQUENCE METHODS_OF_PAYMENT_SEQ OWNED BY METHODS_OF_PAYMENT.MOP_ID;
			SELECT PG_CATALOG.SETVAL('METHODS_OF_PAYMENT_SEQ', 1, FALSE);
		</sql>
	</changeSet>
	<changeSet id="init_changeset_transport_means" author="jan.krajewski">
        <sql>
            CREATE SEQUENCE TRANSPORT_MEANS_SEQ
            START WITH 1
            INCREMENT BY 1
            NO MINVALUE
            NO MAXVALUE
            CACHE 1;
        </sql>
        <sql>            
            CREATE TABLE TRANSPORT_MEANS (
	            transport_id BIGINT NOT NULL DEFAULT nextval('TRANSPORT_MEANS_SEQ'::regclass),
	            transport_name character varying(40) NOT NULL,
	            is_active boolean DEFAULT TRUE NOT NULL,
				VERSION BIGINT DEFAULT (1)::BIGINT NOT NULL
            );
        </sql>
        <sql>                
            ALTER TABLE public.TRANSPORT_MEANS_SEQ OWNER TO admin;
            ALTER TABLE public.TRANSPORT_MEANS OWNER TO admin;
            ALTER TABLE ONLY TRANSPORT_MEANS ADD CONSTRAINT TRANSPORT_MEANS_PK PRIMARY KEY (transport_id);
        </sql>
    </changeSet>
    <changeSet id="init_changeset_departments" author="jan.krajewski">
        <sql>
            CREATE SEQUENCE departments_seq
            START WITH 1
            INCREMENT BY 1
            NO MINVALUE
            NO MAXVALUE
            CACHE 1;
        </sql>
        <sql>            
            CREATE TABLE departments (
            	department_id BIGINT NOT NULL DEFAULT nextval('departments_seq'::regclass),
            	department_name character varying(35) NOT NULL,
            	is_active boolean DEFAULT true NOT NULL,
				VERSION BIGINT DEFAULT (1)::BIGINT NOT NULL
            );
        </sql>
        <sql>
            ALTER TABLE public.departments_seq OWNER TO admin;
            ALTER TABLE public.departments OWNER TO admin;
            ALTER TABLE ONLY departments ADD CONSTRAINT departments_pk PRIMARY KEY (department_id);
        </sql>
    </changeSet>    
    <changeSet id="init_changeset_documents_positions" author="jan.krajewski">
        <sql>
            CREATE SEQUENCE DOCUMENTS_POSITIONS_SEQ
            START WITH 1
            INCREMENT BY 1
            NO MINVALUE
            NO MAXVALUE
            CACHE 1;
        </sql>
        <sql>
            CREATE TABLE documents_positions (
	            document_position_id BIGINT NOT NULL DEFAULT nextval('DOCUMENTS_POSITIONS_SEQ'::regclass),
            	symbol character varying(16) NOT NULL,
	            good_id BIGINT NOT NULL,
	            tax_id BIGINT NOT NULL,
	            quantity double precision NOT NULL,
	            price_net numeric(10,2) NOT NULL,
				VERSION BIGINT DEFAULT (1)::BIGINT NOT NULL
            );

            ALTER TABLE public.documents_positions OWNER TO admin;
            ALTER TABLE ONLY documents_positions ADD CONSTRAINT documents_positions_pk PRIMARY KEY (document_position_id);  
            ALTER TABLE ONLY documents_positions ADD CONSTRAINT documents_positions_fk1 FOREIGN KEY (good_id) REFERENCES goods(good_id);
            ALTER TABLE ONLY documents_positions ADD CONSTRAINT documents_positions_fk2 FOREIGN KEY (tax_id) REFERENCES taxes(tax_id);  
        </sql>
    </changeSet>
    <changeSet id="init_changeset_documents" author="jan.krajewski">
        <sql>
            CREATE SEQUENCE SALE_DOCUMENTS_SEQ
            START WITH 1
            INCREMENT BY 1
            NO MINVALUE
            NO MAXVALUE
            CACHE 1;
        </sql>
		<sql>
            CREATE TABLE sale_documents (
	            sale_document_id BIGINT NOT NULL DEFAULT nextval('SALE_DOCUMENTS_SEQ'::regclass),
	            type character varying(3) NOT NULL,
	            symbol character varying(16) NOT NULL,
	            contractor_id BIGINT NOT NULL,
	            payment_method_id BIGINT NOT NULL,
	            document_place character varying(100),
	            document_date date NOT NULL,
	            sale_date date NOT NULL,
	            payment_date date NOT NULL,
	            total numeric(10,2) NOT NULL,
	            paid numeric(10,2) DEFAULT 0 NOT NULL,
	            discount numeric(4,2) DEFAULT 0.00 NOT NULL,
	            order_symbol character varying(16) NOT NULL,
	            receive_person BIGINT NOT NULL,
	            issue_person BIGINT NOT NULL,
	            warehouse_result boolean DEFAULT true NOT NULL,
	            is_paid boolean DEFAULT true NOT NULL,
	            is_active boolean DEFAULT true NOT NULL, 
				VERSION BIGINT DEFAULT (1)::BIGINT NOT NULL
            );
        </sql>
        <sql>
            ALTER TABLE public.sale_documents OWNER TO admin;
            ALTER TABLE ONLY sale_documents ADD CONSTRAINT sale_documents_pk PRIMARY KEY (sale_document_id);
            ALTER TABLE ONLY sale_documents ADD CONSTRAINT sale_documents_fk1 FOREIGN KEY (contractor_id) REFERENCES CONTRACTORS(CONTRACTOR_ID);
            ALTER TABLE ONLY sale_documents ADD CONSTRAINT sale_documents_fk2 FOREIGN KEY (method_of_payment_id) REFERENCES METHODS_OF_PAYMENT(payment_method_id);        
            ALTER TABLE ONLY sale_documents ADD CONSTRAINT sale_documents_fk4 FOREIGN KEY (receive_person) REFERENCES CONTRACTORS(CONTRACTOR_ID);
            ALTER TABLE ONLY sale_documents ADD CONSTRAINT sale_documents_fk5 FOREIGN KEY (issue_person) REFERENCES users(user_id);
        </sql>
    </changeSet>
</databaseChangeLog>