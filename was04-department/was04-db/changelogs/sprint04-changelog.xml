<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

    <changeSet id="settings_properties_table" author="bartosz.milczarek">
        <createTable tableName="settings">
            <column name="id" type="bigserial" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="settings_pk" />
            </column>
            <column name="property_key" type="VARCHAR(60)">
                <constraints nullable="false" />
            </column>
            <column name="type" type="VARCHAR(15)">
                <constraints nullable="false" />
            </column>
            <column name="key" type="VARCHAR(60)" />
            <column name="value" type="VARCHAR(255)">
                <constraints nullable="false" />
            </column>
        </createTable>
        
        <insert tableName="settings">
            <column name="property_key" value="document.symbol.format" />
            <column name="type" value="SCALAR" />
            <column name="value" value="PREFIKS/NR/RRRR" />
        </insert>
    </changeSet>
    
    <changeSet id="default_value_for_version_methods_of_payment" author="bartosz.milczarek">
        <addDefaultValue tableName="methods_of_payment" columnName="version" defaultValue="1" />
    </changeSet>
    
    <changeSet id="pefix_for_ids" author="bartosz.milczarek">
        <insert tableName="settings">
            <column name="property_key" value="id.prefix" />
            <column name="type" value="SCALAR" />
            <column name="value" value="LDZ" />
        </insert>
        <createView viewName="id_prefix">
            SELECT value as prefix from settings WHERE type = 'SCALAR' AND property_key = 'id.prefix' LIMIT 1
        </createView>
    </changeSet>
    
    <changeSet id="prefix_id_function" author="bartosz.milczarek">
        <sql splitStatements="false">
            CREATE OR REPLACE FUNCTION prefixed_seq(IN _seq_name varchar)
            RETURNS varchar AS
            $BODY$
            SELECT (prefix||trim(to_char(nextval($1::regclass),'0000000000000000000')))::varchar as id FROM id_prefix
            $BODY$
            LANGUAGE sql
        </sql>
    </changeSet> 
    
    <changeSet id="change_id_for_taxes" author="bartosz.milczarek">
        <dropForeignKeyConstraint baseTableName="goods" constraintName="goods_fk1" />
        <modifyDataType tableName="goods" columnName="tax_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="taxes" columnName="tax_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="goods" baseColumnNames="tax_id" constraintName="goods_fk1" referencedTableName="taxes" referencedColumnNames="tax_id" />
        <addDefaultValue tableName="taxes" columnName="tax_id" defaultValueComputed="prefixed_seq('taxes_seq')" />
    </changeSet>
    
    <changeSet id="update_id_taxes_with_prefix" author="bartosz.milczarek">
        <update tableName="taxes">
            <column name="tax_id" valueComputed="'LDZ'||trim(to_char(tax_id::bigint,'0000000000000000000'))" />
        </update>
    </changeSet>
    
    <changeSet id="change_id_for_units" author="bartosz.milczarek">
        <dropForeignKeyConstraint baseTableName="goods" constraintName="goods_fk2" />
        <modifyDataType tableName="goods" columnName="unit_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="units" columnName="unit_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="goods" baseColumnNames="unit_id" constraintName="goods_fk2" referencedTableName="units" referencedColumnNames="unit_id" />
        <addDefaultValue tableName="units" columnName="unit_id" defaultValueComputed="prefixed_seq('units_seq')" />
        <update tableName="units">
            <column name="unit_id" valueComputed="'LDZ'||trim(to_char(unit_id::bigint,'0000000000000000000'))" />
        </update>
    </changeSet>
    
    <changeSet id="change_id_for_goods_groups" author="bartosz.milczarek">
        <dropForeignKeyConstraint baseTableName="goods" constraintName="goods_fk3" />
        <modifyDataType tableName="goods" columnName="good_group_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="goods_groups" columnName="good_group_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="goods" baseColumnNames="good_group_id" constraintName="goods_fk3" referencedTableName="goods_groups" referencedColumnNames="good_group_id" />
        <addDefaultValue tableName="goods_groups" columnName="good_group_id" defaultValueComputed="prefixed_seq('goods_groups_seq')" />
        <update tableName="goods_groups">
            <column name="good_group_id" valueComputed="'LDZ'||trim(to_char(good_group_id::bigint,'0000000000000000000'))" />
        </update>
    </changeSet>
    
    <changeSet id="change_id_for_sources_of_member" author="bartosz.milczarek">
        <dropForeignKeyConstraint baseTableName="contractors" constraintName="contractors_fk2" />
        <modifyDataType tableName="contractors" columnName="source_of_member_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="sources_of_member" columnName="source_of_member_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="contractors" baseColumnNames="source_of_member_id" constraintName="contractors_fk2" referencedTableName="sources_of_member" referencedColumnNames="source_of_member_id" />
        <addDefaultValue tableName="sources_of_member" columnName="source_of_member_id" defaultValueComputed="prefixed_seq('sources_of_member_seq')" />
        <update tableName="sources_of_member">
            <column name="source_of_member_id" valueComputed="'LDZ'||trim(to_char(source_of_member_id::bigint,'0000000000000000000'))" />
        </update>
    </changeSet>
    
    <changeSet id="change_id_for_contractors_groups" author="bartosz.milczarek">
        <dropForeignKeyConstraint baseTableName="contractors" constraintName="contractors_fk1" />
        <modifyDataType tableName="contractors" columnName="contractor_group_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="contractors_groups" columnName="contractor_group_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="contractors" baseColumnNames="contractor_group_id" constraintName="contractors_fk1" referencedTableName="contractors_groups" referencedColumnNames="contractor_group_id" />
        <addDefaultValue tableName="contractors_groups" columnName="contractor_group_id" defaultValueComputed="prefixed_seq('contractors_groups_seq')" />
        <update tableName="contractors_groups">
            <column name="contractor_group_id" valueComputed="'LDZ'||trim(to_char(contractor_group_id::bigint,'0000000000000000000'))" />
        </update>
    </changeSet>
    
    <changeSet id="change_id_for_contractors_and_goods" author="bartosz.milczarek">
        <modifyDataType tableName="contractors" columnName="contractor_id" newDataType="VARCHAR(24)" />
        <addDefaultValue tableName="contractors" columnName="contractor_id" defaultValueComputed="prefixed_seq('contractors_seq')" />
        <update tableName="contractors">
            <column name="contractor_id" valueComputed="'LDZ'||trim(to_char(contractor_id::bigint,'0000000000000000000'))" />
        </update>
        <modifyDataType tableName="goods" columnName="good_id" newDataType="VARCHAR(24)" />
        <addDefaultValue tableName="goods" columnName="good_id" defaultValueComputed="prefixed_seq('goods_seq')" />
        <update tableName="goods">
            <column name="good_id" valueComputed="'LDZ'||trim(to_char(good_id::bigint,'0000000000000000000'))" />
        </update>
    </changeSet>
    
    <changeSet id="change_id_for_users" author="bartosz.milczarek">
        <dropView viewName="auth_view" />
        <dropForeignKeyConstraint baseTableName="users_roles" constraintName="users_roles_fk1" />
        <modifyDataType tableName="users_roles" columnName="user_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="users" columnName="user_id" newDataType="VARCHAR(24)" />
        <addDefaultValue tableName="users" columnName="user_id" defaultValueComputed="prefixed_seq('users_seq')" />
        <update tableName="users">
            <column name="user_id" valueComputed="'LDZ'||trim(to_char(user_id::bigint,'0000000000000000000'))" />
        </update>
        <update tableName="users_roles">
            <column name="user_id" valueComputed="'LDZ'||trim(to_char(user_id::bigint,'0000000000000000000'))" />
        </update>
        <addForeignKeyConstraint baseTableName="users_roles" baseColumnNames="user_id" constraintName="users_roles_fk1" referencedTableName="users" referencedColumnNames="user_id" />
        <sql splitStatements="false">
            CREATE OR REPLACE VIEW auth_view AS 
            SELECT u.login, u.password, r.role_name FROM users u
            JOIN users_roles ur ON u.user_id = ur.user_id
            JOIN roles r ON ur.role_id = r.role_id;

            ALTER TABLE auth_view OWNER TO admin;
            GRANT ALL ON TABLE auth_view TO admin;
            GRANT SELECT ON TABLE auth_view TO glassfish;
        </sql>
    </changeSet>
    
    <changeSet id="change_id_for_methods_of_payment" author="bartosz.milczarek">
        <modifyDataType tableName="methods_of_payment" columnName="mop_id" newDataType="VARCHAR(24)" />
        <addDefaultValue tableName="methods_of_payment" columnName="mop_id" defaultValueComputed="prefixed_seq('methods_of_payment_seq')" />
        <update tableName="methods_of_payment">
            <column name="mop_id" valueComputed="'LDZ'||trim(to_char(mop_id::bigint,'0000000000000000000'))" />
        </update>
    </changeSet>
    
    <changeSet id="users_table_changes" author="lukasz.gadomski">
        <dropView viewName="auth_view" />
        <dropColumn tableName="users" columnName="login" />
        <sql splitStatements="false">
            CREATE OR REPLACE VIEW AUTH_VIEW AS 
            SELECT U.EMAIL, U.PASSWORD, R.ROLE_NAME 
            FROM USERS U
            INNER JOIN USERS_ROLES UR ON U.USER_ID = UR.USER_ID
            INNER JOIN ROLES R ON UR.ROLE_ID = R.ROLE_ID
            WHERE U.IS_ACTIVE = true;

            GRANT SELECT ON AUTH_VIEW TO glassfish;
            
            CREATE SEQUENCE PENDING_INVITATIONS_SEQ
            START WITH 1
            INCREMENT BY 1
            NO MINVALUE
            NO MAXVALUE
            CACHE 1;

            CREATE TABLE pending_invitations (
            invitation_id INTEGER PRIMARY KEY NOT NULL DEFAULT NEXTVAL('PENDING_INVITATIONS_SEQ'::REGCLASS),
            email CHARACTER VARYING(40) NOT NULL,
            role_id INTEGER NOT NULL REFERENCES ROLES(role_id),
            token VARCHAR(64) NOT NULL,
            creation_date TIMESTAMPTZ NOT NULL
            );

            ALTER TABLE pending_invitations OWNER TO admin;
            ALTER TABLE PENDING_INVITATIONS_SEQ OWNER TO admin;
            ALTER SEQUENCE PENDING_INVITATIONS_SEQ OWNED BY pending_invitations.invitation_id;
            SELECT PG_CATALOG.SETVAL('PENDING_INVITATIONS_SEQ', 1, TRUE);
            
            CREATE TABLE PASSWORD_CHANGE_REQUESTS (
            ID CHARACTER(64) PRIMARY KEY NOT NULL,
            USER_ID VARCHAR(24) NOT NULL REFERENCES USERS(USER_ID),
            CREATION_DATE TIMESTAMPTZ NOT NULL
            );

            ALTER TABLE PASSWORD_CHANGE_REQUESTS OWNER TO admin;
        </sql>
    </changeSet>
    
    <changeSet id="goods_adjustment_rev41_42" author="bartosz.milczarek">
        <modifyDataType tableName="goods" columnName="type" newDataType="VARCHAR(10)" />
        <dropNotNullConstraint tableName="goods" columnName="PRICE_B_NET" />
        <dropNotNullConstraint tableName="goods" columnName="PRICE_B_GROSS" />
        <dropNotNullConstraint tableName="goods" columnName="PRICE_C_NET" />
        <dropNotNullConstraint tableName="goods" columnName="PRICE_C_GROSS" />
        <dropNotNullConstraint tableName="goods" columnName="PKWIU" />
        <dropColumn tableName="goods" columnName="photo" />
    </changeSet>
    
    <changeSet id="goods_adjustment_rev41_42_part2" author="bartosz.milczarek">
        <dropNotNullConstraint tableName="goods" columnName="WEIGHT" />
    </changeSet>
    
    <changeSet id="goods_adjustment_rev41_42_part3" author="bartosz.milczarek">
        <dropNotNullConstraint tableName="goods" columnName="description" />
    </changeSet>
    
    <changeSet id="contractors_add_description_column" author="bartosz.milczarek">
        <addColumn tableName="contractors">
            <column name="description" type="TEXT" />
        </addColumn>
    </changeSet>
    
    <changeSet id="contractors_add_is_supplier_column" author="bartosz.milczarek">
        <addColumn tableName="contractors">
            <column name="is_supplier" type="boolean" defaultValue="false" />
        </addColumn>
    </changeSet>
    
    <changeSet id="warehouses_table" author="jan.krajewski">
        <sql>
            CREATE SEQUENCE warehouses_seq
            START WITH 1
            INCREMENT BY 1
            NO MINVALUE
            NO MAXVALUE
            CACHE 1;

            CREATE TABLE warehouses (
            warehouse_id smallint DEFAULT nextval('warehouses_seq'::regclass) NOT NULL,
            warehouse_name character varying(40) NOT NULL,
            warehouse_short_name character varying(4) DEFAULT ''::character varying NOT NULL,
            is_default boolean DEFAULT false NOT NULL,
            version BIGINT NOT NULL
            );

            ALTER TABLE public.warehouses OWNER TO admin;
            ALTER TABLE public.warehouses_seq OWNER TO admin;
            ALTER TABLE ONLY warehouses ADD CONSTRAINT warehouses_pk PRIMARY KEY (warehouse_id);
            CREATE UNIQUE INDEX warehouses_uk ON warehouses USING btree (warehouse_short_name);
        </sql>
    </changeSet>
    <changeSet id="means_of_transport_table" author="jan.krajewski">
        <sql>
            CREATE SEQUENCE means_of_transport_seq
            START WITH 1
            INCREMENT BY 1
            NO MINVALUE
            NO MAXVALUE
            CACHE 1;
            
            CREATE TABLE means_of_transport (
            transport_id smallint DEFAULT nextval('means_of_transport_seq'::regclass) NOT NULL,
            transport_name character varying(40) NOT NULL,
            is_active boolean DEFAULT true NOT NULL,
            version BIGINT NOT NULL
            );
                
            ALTER TABLE public.means_of_transport_seq OWNER TO admin;
            ALTER TABLE public.means_of_transport OWNER TO admin;
            ALTER TABLE ONLY means_of_transport ADD CONSTRAINT means_of_transport_pk PRIMARY KEY (transport_id);
        </sql>
    </changeSet>
    <changeSet id="document_places_tables" author="jan.krajewski">
        <sql>
            CREATE SEQUENCE document_places_seq
            START WITH 1
            INCREMENT BY 1
            NO MINVALUE
            NO MAXVALUE
            CACHE 1;
            
            CREATE TABLE document_places (
            document_place_id smallint DEFAULT nextval('document_places_seq'::regclass) NOT NULL,
            document_place_name character varying(35) NOT NULL,
            is_active boolean DEFAULT true NOT NULL,
            version BIGINT NOT NULL
            );
            
            ALTER TABLE public.document_places_seq OWNER TO admin;
            ALTER TABLE public.document_places OWNER TO admin;
            ALTER TABLE ONLY document_places ADD CONSTRAINT document_places_pk PRIMARY KEY (document_place_id);
        </sql>
    </changeSet>
    <changeSet id="departments_tables" author="jan.krajewski">
        <sql>
            CREATE SEQUENCE departments_seq
            START WITH 1
            INCREMENT BY 1
            NO MINVALUE
            NO MAXVALUE
            CACHE 1;
            
            CREATE TABLE departments (
            department_id smallint DEFAULT nextval('departments_seq'::regclass) NOT NULL,
            department_name character varying(35) NOT NULL,
            is_active boolean DEFAULT true NOT NULL,
            version BIGINT NOT NULL
            );
            
            ALTER TABLE public.departments_seq OWNER TO admin;
            ALTER TABLE public.departments OWNER TO admin;
            ALTER TABLE ONLY departments ADD CONSTRAINT departments_pk PRIMARY KEY (department_id);
        </sql>
    </changeSet>
    <changeSet id="warehouse_documents_table" author="jan.krajewski">
        <sql>
            CREATE TABLE warehouse_documents (
            type character varying(3) NOT NULL,
            symbol character varying(16) NOT NULL,
            contractor_id VARCHAR(24),
            document_place_id smallint DEFAULT (1)::smallint NOT NULL,
            document_date date,
            warehouse_date date, 
            total numeric(10,2) NOT NULL,
            receive_person VARCHAR(24) DEFAULT ''::character varying NOT NULL,
            issue_person VARCHAR(24) DEFAULT ''::character varying NOT NULL, 
            department_id smallint DEFAULT 0 NOT NULL,
            transport_id smallint DEFAULT (0)::smallint NOT NULL,
            waybill_number character varying(15) DEFAULT ''::character varying NOT NULL, 
            warehouse_result boolean DEFAULT true NOT NULL,
            warehouse_id smallint NOT NULL,
            is_active boolean DEFAULT true NOT NULL,            
            version BIGINT NOT NULL
            );
            
            ALTER TABLE public.warehouse_documents OWNER TO admin;
            ALTER TABLE ONLY warehouse_documents ADD CONSTRAINT warehouse_documents_pk PRIMARY KEY (symbol, warehouse_id);
            ALTER TABLE ONLY warehouse_documents ADD CONSTRAINT warehouse_documents_fk1 FOREIGN KEY (warehouse_id) REFERENCES WAREHOUSES(WAREHOUSE_ID);
            ALTER TABLE ONLY warehouse_documents ADD CONSTRAINT warehouse_documents_fk2 FOREIGN KEY (contractor_id) REFERENCES CONTRACTORS(CONTRACTOR_ID);
            ALTER TABLE ONLY warehouse_documents ADD CONSTRAINT warehouse_documents_fk4 FOREIGN KEY (transport_id) REFERENCES MEANS_OF_TRANSPORT(TRANSPORT_ID);
            ALTER TABLE ONLY warehouse_documents ADD CONSTRAINT warehouse_documents_fk3 FOREIGN KEY (department_id) REFERENCES DEPARTMENTS(DEPARTMENT_ID);
            ALTER TABLE ONLY warehouse_documents ADD CONSTRAINT warehouse_documents_fk5 FOREIGN KEY (document_place_id) REFERENCES DOCUMENT_PLACES(DOCUMENT_PLACE_ID);
            ALTER TABLE ONLY warehouse_documents ADD CONSTRAINT warehouse_documents_fk6 FOREIGN KEY (receive_person) REFERENCES CONTRACTORS(CONTRACTOR_ID);
            ALTER TABLE ONLY warehouse_documents ADD CONSTRAINT warehouse_documents_fk7 FOREIGN KEY (issue_person) REFERENCES users(user_id);
        </sql>
    </changeSet>
    <changeSet id="sale_documents_table" author="jan.krajewski">
        <sql>
            CREATE TABLE sale_documents (
            type character varying(3) NOT NULL,
            symbol character varying(16) NOT NULL,
            contractor_id VARCHAR(24) NOT NULL,
            method_of_payment_id VARCHAR(24) NOT NULL,
            document_place_id smallint DEFAULT (1)::smallint NOT NULL,
            document_date date NOT NULL,
            sale_date date NOT NULL,
            payment_date date NOT NULL,
            total numeric(10,2) NOT NULL,
            paid numeric(10,2) DEFAULT 0 NOT NULL,
            discount numeric(4,2) DEFAULT 0.00 NOT NULL,
            order_symbol character varying(16) NOT NULL,
            receive_person VARCHAR(24) DEFAULT '' NOT NULL,
            issue_person VARCHAR(24) DEFAULT '' NOT NULL,
            warehouse_result boolean DEFAULT true NOT NULL,
            warehouse_id smallint NOT NULL,
            is_paid boolean DEFAULT true NOT NULL,
            is_active boolean DEFAULT true NOT NULL,            
            version BIGINT NOT NULL
            );

            ALTER TABLE public.sale_documents OWNER TO admin;
            ALTER TABLE ONLY sale_documents ADD CONSTRAINT sale_documents_pk PRIMARY KEY (symbol, warehouse_id);
            ALTER TABLE ONLY sale_documents ADD CONSTRAINT sale_documents_fk1 FOREIGN KEY (warehouse_id) REFERENCES warehouses(warehouse_id);
            ALTER TABLE ONLY sale_documents ADD CONSTRAINT sale_documents_fk2 FOREIGN KEY (contractor_id) REFERENCES CONTRACTORS(CONTRACTOR_ID);
            ALTER TABLE ONLY sale_documents ADD CONSTRAINT sale_documents_fk3 FOREIGN KEY (method_of_payment_id) REFERENCES METHODS_OF_PAYMENT(mop_id);           
            ALTER TABLE ONLY sale_documents ADD CONSTRAINT sale_documents_fk4 FOREIGN KEY (document_place_id) REFERENCES DOCUMENT_PLACES(DOCUMENT_PLACE_ID);
            ALTER TABLE ONLY sale_documents ADD CONSTRAINT sale_documents_fk5 FOREIGN KEY (receive_person) REFERENCES CONTRACTORS(CONTRACTOR_ID);
            ALTER TABLE ONLY sale_documents ADD CONSTRAINT sale_documents_fk6 FOREIGN KEY (issue_person) REFERENCES users(user_id);
        </sql>
    </changeSet>
    <changeSet id="documents_positions_table" author="jan.krajewski">
        <sql>
            CREATE TABLE documents_positions (
            document_symbol character varying(16) NOT NULL,
            good_id VARCHAR(24) NOT NULL,
            quantity double precision NOT NULL,
            price_net numeric(10,2) NOT NULL,
            tax_id VARCHAR(24) NOT NULL,
            warehouse_id integer DEFAULT 1 NOT NULL,            
            version BIGINT NOT NULL
            );

            ALTER TABLE public.documents_positions OWNER TO admin;
            ALTER TABLE ONLY documents_positions ADD CONSTRAINT documents_positions_pk PRIMARY KEY (warehouse_id, document_symbol, good_id);  
            ALTER TABLE ONLY documents_positions ADD CONSTRAINT documents_positions_fk1 FOREIGN KEY (good_id) REFERENCES goods(good_id);
            ALTER TABLE ONLY documents_positions ADD CONSTRAINT documents_positions_fk2 FOREIGN KEY (tax_id) REFERENCES taxes(tax_id);  
            ALTER TABLE ONLY documents_positions ADD CONSTRAINT documents_positions_fk3 FOREIGN KEY (warehouse_id) REFERENCES warehouses(warehouse_id); 
        </sql>
    </changeSet>
    
    <changeSet id="change_id_for_warehouses" author="jan.krajewski">
        <dropForeignKeyConstraint baseTableName="documents_positions" constraintName="documents_positions_fk3" />
        <dropForeignKeyConstraint baseTableName="sale_documents" constraintName="sale_documents_fk1" />
        <dropForeignKeyConstraint baseTableName="warehouse_documents" constraintName="warehouse_documents_fk1" />
        <modifyDataType tableName="warehouses" columnName="warehouse_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="documents_positions" columnName="warehouse_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="sale_documents" columnName="warehouse_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="warehouse_documents" columnName="warehouse_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="documents_positions" baseColumnNames="warehouse_id" constraintName="documents_positions_fk3" referencedTableName="warehouses" referencedColumnNames="warehouse_id" />
        <addForeignKeyConstraint baseTableName="sale_documents" baseColumnNames="warehouse_id" constraintName="sale_documents_fk1" referencedTableName="warehouses" referencedColumnNames="warehouse_id" />
        <addForeignKeyConstraint baseTableName="warehouse_documents" baseColumnNames="warehouse_id" constraintName="warehouse_documents_fk1" referencedTableName="warehouses" referencedColumnNames="warehouse_id" />
        <addDefaultValue tableName="warehouses" columnName="warehouse_id" defaultValueComputed="prefixed_seq('warehouses_seq')" />
        <update tableName="warehouses">
            <column name="warehouse_id" valueComputed="'LDZ'||trim(to_char(warehouse_id::bigint,'0000000000000000000'))" />
        </update>
    </changeSet>    
    
    <changeSet id="change_id_for_means_of_transport" author="jan.krajewski">
        <dropForeignKeyConstraint baseTableName="warehouse_documents" constraintName="warehouse_documents_fk4" />
        <modifyDataType tableName="means_of_transport" columnName="transport_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="warehouse_documents" columnName="transport_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="warehouse_documents" baseColumnNames="transport_id" constraintName="warehouse_documents_fk4" referencedTableName="means_of_transport" referencedColumnNames="transport_id" />
        <addDefaultValue tableName="warehouse_documents" columnName="transport_id" defaultValueComputed="prefixed_seq('means_of_transport_seq')" />
        <update tableName="means_of_transport">
            <column name="transport_id" valueComputed="'LDZ'||trim(to_char(transport_id::bigint,'0000000000000000000'))" />
        </update>
    </changeSet>
    
    <changeSet id="change_id_for_document_places" author="jan.krajewski">
        <dropForeignKeyConstraint baseTableName="warehouse_documents" constraintName="warehouse_documents_fk5" />
        <dropForeignKeyConstraint baseTableName="sale_documents" constraintName="sale_documents_fk4" />
        <modifyDataType tableName="document_places" columnName="document_place_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="warehouse_documents" columnName="document_place_id" newDataType="VARCHAR(24)" /> 
        <modifyDataType tableName="sale_documents" columnName="document_place_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="warehouse_documents" baseColumnNames="document_place_id" constraintName="warehouse_documents_fk5" referencedTableName="document_places" referencedColumnNames="document_place_id" />
        <addForeignKeyConstraint baseTableName="sale_documents" baseColumnNames="document_place_id" constraintName="sale_documents_fk4" referencedTableName="document_places" referencedColumnNames="document_place_id" />
        <addDefaultValue tableName="document_places" columnName="document_place_id" defaultValueComputed="prefixed_seq('document_places_seq')" />
        <update tableName="document_places">
            <column name="document_place_id" valueComputed="'LDZ'||trim(to_char(document_place_id::bigint,'0000000000000000000'))" />
        </update>
    </changeSet>
    
    <changeSet id="change_id_for_departments" author="jan.krajewski">
        <dropForeignKeyConstraint baseTableName="warehouse_documents" constraintName="warehouse_documents_fk3" />
        <modifyDataType tableName="departments" columnName="department_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="warehouse_documents" columnName="department_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="warehouse_documents" baseColumnNames="department_id" constraintName="warehouse_documents_fk3" referencedTableName="departments" referencedColumnNames="department_id" />
        <addDefaultValue tableName="departments" columnName="department_id" defaultValueComputed="prefixed_seq('departments_seq')" />
        <update tableName="departments">
            <column name="department_id" valueComputed="'LDZ'||trim(to_char(department_id::bigint,'0000000000000000000'))" />
        </update>
    </changeSet>
    
    <changeSet id="change_id_for_documents" author="jan.krajewski">
        <dropForeignKeyConstraint baseTableName="documents_positions" constraintName="documents_positions_fk2" />
        <modifyDataType tableName="documents_positions" columnName="tax_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="documents_positions" baseColumnNames="tax_id" constraintName="documents_positions_fk2" referencedTableName="taxes" referencedColumnNames="tax_id" />
        <dropForeignKeyConstraint baseTableName="sale_documents" constraintName="sale_documents_fk2" />
        <dropForeignKeyConstraint baseTableName="sale_documents" constraintName="sale_documents_fk5" />
        <dropForeignKeyConstraint baseTableName="warehouse_documents" constraintName="warehouse_documents_fk2" />
        <dropForeignKeyConstraint baseTableName="warehouse_documents" constraintName="warehouse_documents_fk6" />
        <modifyDataType tableName="sale_documents" columnName="contractor_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="sale_documents" columnName="receive_person" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="warehouse_documents" columnName="contractor_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="warehouse_documents" columnName="receive_person" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="sale_documents" baseColumnNames="contractor_id" constraintName="sale_documents_fk2" referencedTableName="contractors" referencedColumnNames="contractor_id" />
        <addForeignKeyConstraint baseTableName="sale_documents" baseColumnNames="receive_person" constraintName="sale_documents_fk5" referencedTableName="contractors" referencedColumnNames="contractor_id" />
        <addForeignKeyConstraint baseTableName="warehouse_documents" baseColumnNames="contractor_id" constraintName="warehouse_documents_fk2" referencedTableName="contractors" referencedColumnNames="contractor_id" />
        <addForeignKeyConstraint baseTableName="warehouse_documents" baseColumnNames="receive_person" constraintName="warehouse_documents_fk6" referencedTableName="contractors" referencedColumnNames="contractor_id" />
        <dropForeignKeyConstraint baseTableName="documents_positions" constraintName="documents_positions_fk1" />
        <modifyDataType tableName="documents_positions" columnName="good_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="documents_positions" baseColumnNames="good_id" constraintName="documents_positions_fk1" referencedTableName="goods" referencedColumnNames="good_id" />
        <dropForeignKeyConstraint baseTableName="sale_documents" constraintName="sale_documents_fk6" />
        <dropForeignKeyConstraint baseTableName="warehouse_documents" constraintName="warehouse_documents_fk7" />
        <modifyDataType tableName="sale_documents" columnName="issue_person" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="warehouse_documents" columnName="issue_person" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="sale_documents" baseColumnNames="issue_person" constraintName="sale_documents_fk6" referencedTableName="users" referencedColumnNames="user_id" />
        <addForeignKeyConstraint baseTableName="warehouse_documents" baseColumnNames="issue_person" constraintName="warehouse_documents_fk7" referencedTableName="users" referencedColumnNames="user_id" />
        <dropForeignKeyConstraint baseTableName="sale_documents" constraintName="sale_documents_fk3" />
        <modifyDataType tableName="sale_documents" columnName="method_of_payment_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="sale_documents" baseColumnNames="method_of_payment_id" constraintName="sale_documents_fk3" referencedTableName="methods_of_payment" referencedColumnNames="mop_id" />
        <dropForeignKeyConstraint baseTableName="documents_positions" constraintName="documents_positions_fk3" />
        <dropForeignKeyConstraint baseTableName="sale_documents" constraintName="sale_documents_fk1" />
        <dropForeignKeyConstraint baseTableName="warehouse_documents" constraintName="warehouse_documents_fk1" />
        <modifyDataType tableName="warehouses" columnName="warehouse_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="documents_positions" columnName="warehouse_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="sale_documents" columnName="warehouse_id" newDataType="VARCHAR(24)" />
        <modifyDataType tableName="warehouse_documents" columnName="warehouse_id" newDataType="VARCHAR(24)" />
        <addForeignKeyConstraint baseTableName="documents_positions" baseColumnNames="warehouse_id" constraintName="documents_positions_fk3" referencedTableName="warehouses" referencedColumnNames="warehouse_id" />
        <addForeignKeyConstraint baseTableName="sale_documents" baseColumnNames="warehouse_id" constraintName="sale_documents_fk1" referencedTableName="warehouses" referencedColumnNames="warehouse_id" />
        <addForeignKeyConstraint baseTableName="warehouse_documents" baseColumnNames="warehouse_id" constraintName="warehouse_documents_fk1" referencedTableName="warehouses" referencedColumnNames="warehouse_id" />
        <addDefaultValue tableName="warehouses" columnName="warehouse_id" defaultValueComputed="prefixed_seq('warehouses_seq')" />
        <update tableName="warehouses">
            <column name="warehouse_id" valueComputed="'LDZ'||trim(to_char(warehouse_id::bigint,'0000000000000000000'))" />
        </update>
    </changeSet>
    
</databaseChangeLog>